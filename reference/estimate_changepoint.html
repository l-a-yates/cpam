<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Use model selection to estimate changepoints — estimate_changepoint • cpam</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use model selection to estimate changepoints — estimate_changepoint"><meta name="description" content="Use model selection to estimate changepoints"><meta property="og:description" content="Use model selection to estimate changepoints"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cpam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Use model selection to estimate changepoints</h1>

      <div class="d-none name"><code>estimate_changepoint.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Use model selection to estimate changepoints</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_changepoint</span><span class="op">(</span></span>
<span>  <span class="va">cpo</span>,</span>
<span>  cps <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  degs_only <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  deg_threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bss <span class="op">=</span> <span class="st">"tp"</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nb"</span>, <span class="st">"gaussian"</span><span class="op">)</span>,</span>
<span>  score <span class="op">=</span> <span class="st">"aic"</span>,</span>
<span>  compute_mvn <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-cpo">cpo<a class="anchor" aria-label="anchor" href="#arg-cpo"></a></dt>
<dd><p>a cpam object</p></dd>


<dt id="arg-cps">cps<a class="anchor" aria-label="anchor" href="#arg-cps"></a></dt>
<dd><p>vector of candidate changepoints. Defaults to the set of observed timepoints</p></dd>


<dt id="arg-degs-only">degs_only<a class="anchor" aria-label="anchor" href="#arg-degs-only"></a></dt>
<dd><p>logical; should changepoints only be estimated for differentially expressed genes</p></dd>


<dt id="arg-deg-threshold">deg_threshold<a class="anchor" aria-label="anchor" href="#arg-deg-threshold"></a></dt>
<dd><p>logical; the threshold value for DEGs (ignored of <code>degs_only = F</code>)</p></dd>


<dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>character vector; names of targets or genes (if <code>cpo$gene_level = T</code>)
for which changepoints will be estimated</p></dd>


<dt id="arg-sp">sp<a class="anchor" aria-label="anchor" href="#arg-sp"></a></dt>
<dd><p>numerical &gt;= 0; supply a fixed smoothing parameter.
This can decrease the fitting time but it is not recommended as changepoints estimation
is sensitive to smoothness.</p></dd>


<dt id="arg-bss">bss<a class="anchor" aria-label="anchor" href="#arg-bss"></a></dt>
<dd><p>character vector; names of candidate spline bases (i.e., candidate shape types).
Default is thin plate ("tp") splines.</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>character; negative binomial ("nb", default) or Gaussian ("gaussian", not currently supported)</p></dd>


<dt id="arg-score">score<a class="anchor" aria-label="anchor" href="#arg-score"></a></dt>
<dd><p>character; model selection score, either Generalised Cross Validation ("gcv") or
Akaike Information Criterion ("aic")</p></dd>


<dt id="arg-compute-mvn">compute_mvn<a class="anchor" aria-label="anchor" href="#arg-compute-mvn"></a></dt>
<dd><p>Use simulation to compute p-value under multivariate normal model of the
model scores</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a cpam object with the estimated changepoint table added to the slot "changepoints"</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function estimates changepoints for each target_id. The assumed
trajectory type for this modelling stage is initially constant followed by
a changepoint into thin-plate smoothing spline.</p>
<p>By default, candidate time points are limited to the discrete observed values
in the series, since, despite the use of smoothing constraints,
there is generally insufficient information to infer the timing of
changepoints beyond the temporal resolution of the data. In any case, the
candidate points can be set manually using the <code>cps</code> argument.</p>
<p>To estimate changepoints, a model is fit for each candidate changepoint and
generalised cross-validation (GCV, default) or the Akaike Information
Criterion (AIC) are used to select among them. Model-selection uncertainty
is dealt with by computing the one-standard-error rule, which identifies the
least complex model within one standard error of the best scoring model.</p>
<p>Both the minimum and the one-standard-error (default) models are stored in the returned
slot "changepoints" so that either can be used. In addition to these, this function also computes the
probability (denoted <code>p_mvn</code>) that the null model is the best scoring model, using a simulation
based approach based on the multivariate normal model of the pointwise
model scores.</p>
<p>Given the computational cost of fitting a separate model for each candidate
changepoint, cpam only estimates changepoints for targets associated with
'significant' genes at the chosen threshold <code>deg_threshold</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Yates, L. A., S. A. Richards, and B. W. Brook. 2021.
Parsimonious model selection using information theory:
a modified selection rule.
Ecology 102(10):e03475. 10.1002/ecy.3475</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://l-a-yates.github.io/cpam/">cpam</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using a small subset of the example data</span></span></span>
<span class="r-in"><span><span class="va">cpo</span> <span class="op">&lt;-</span> <span class="fu"><a href="prepare_cpam.html">prepare_cpam</a></span><span class="op">(</span>exp_design <span class="op">=</span> <span class="va">exp_design_example</span>,</span></span>
<span class="r-in"><span>                    count_matrix <span class="op">=</span> <span class="va">count_matrix_example</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,<span class="op">]</span>,</span></span>
<span class="r-in"><span>                    gene_level <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                    num_cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtering low count genes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimating dispersions using edgeR</span>
<span class="r-in"><span><span class="va">cpo</span> <span class="op">&lt;-</span> <span class="fu"><a href="compute_p_values.html">compute_p_values</a></span><span class="op">(</span><span class="va">cpo</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cpo</span> <span class="op">&lt;-</span> <span class="fu">estimate_changepoint</span><span class="op">(</span><span class="va">cpo</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimating changepoints for 3 targets</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Candidate changepoints are t = 1, 2, 3, 4, 5, 6.</span>
<span class="r-in"><span><span class="va">cpo</span><span class="op">$</span><span class="va">changepoints</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 3 × 7</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   target_id cp_min cp_1se  p_mvn bs    family score_table      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> g003           1      1 0      tp    nb     <span style="color: #949494;">&lt;tibble [30 × 6]&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> g013           3      3 0      tp    nb     <span style="color: #949494;">&lt;tibble [30 × 6]&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> g014           1      5 0.076<span style="text-decoration: underline;">9</span> tp    nb     <span style="color: #949494;">&lt;tibble [30 × 6]&gt;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example Experimental Design</span></span></span>
<span class="r-in"><span><span class="va">exp_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"path/"</span>,<span class="va">sample</span>,<span class="st">"/abundance.h5"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example Transcript-to-Gene Mapping</span></span></span>
<span class="r-in"><span><span class="va">t2g</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu">read_csv</span><span class="op">(</span><span class="st">"path/to/t2g.csv"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit model</span></span></span>
<span class="r-in"><span><span class="va">cpo</span> <span class="op">&lt;-</span> <span class="fu"><a href="prepare_cpam.html">prepare_cpam</a></span><span class="op">(</span></span></span>
<span class="r-in"><span> exp_design <span class="op">=</span> <span class="va">exp_design</span>,</span></span>
<span class="r-in"><span> t2g <span class="op">=</span> <span class="va">t2g</span>,</span></span>
<span class="r-in"><span> import_type <span class="op">=</span> <span class="st">"kallisto"</span>,</span></span>
<span class="r-in"><span> num_cores <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cpo</span> <span class="op">&lt;-</span> <span class="fu"><a href="compute_p_values.html">compute_p_values</a></span><span class="op">(</span><span class="va">cpo</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cpo</span> <span class="op">&lt;-</span> <span class="fu">estimate_changepoint</span><span class="op">(</span><span class="va">cpo</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cpo</span><span class="op">$</span><span class="va">changepoints</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luke Yates, Michael Charleston, Jazmine Humphreys, Steven Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

