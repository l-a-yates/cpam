<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Use model selection to select a shape for each target — select_shape • cpam</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use model selection to select a shape for each target — select_shape"><meta name="description" content="Use model selection to select a shape for each target"><meta property="og:description" content="Use model selection to select a shape for each target"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cpam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/cpam.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/l-a-yates/cpam/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Use model selection to select a shape for each target</h1>
      <small class="dont-index">Source: <a href="https://github.com/l-a-yates/cpam/blob/main/R/select_shape.R" class="external-link"><code>R/select_shape.R</code></a></small>
      <div class="d-none name"><code>select_shape.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Use model selection to select a shape for each target</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">select_shape</span><span class="op">(</span></span>
<span>  <span class="va">cpo</span>,</span>
<span>  subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"micv"</span>, <span class="st">"mdcx"</span>, <span class="st">"cv"</span>, <span class="st">"cx"</span>, <span class="st">"lin"</span>, <span class="st">"tp"</span>, <span class="st">"null"</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nb"</span>, <span class="st">"gaussian"</span><span class="op">)</span>,</span>
<span>  score <span class="op">=</span> <span class="st">"gcv"</span>,</span>
<span>  cp_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cp_1se"</span>, <span class="st">"cp_min"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-cpo">cpo<a class="anchor" aria-label="anchor" href="#arg-cpo"></a></dt>
<dd><p>a cpam object</p></dd>


<dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>character vector; names of targets or genes (if <code>cpo$gene_level = T</code>)
for which changepoints will be estimated</p></dd>


<dt id="arg-sp">sp<a class="anchor" aria-label="anchor" href="#arg-sp"></a></dt>
<dd><p>numerical &gt;= 0; supply a fixed smoothing parameter. If NULL (default), the smoothing
parameter is estimated. Note, this fixed value is in any case applied only to
shape constrained bases (i.e., not <code>bs = 'tp'</code>).</p></dd>


<dt id="arg-bss">bss<a class="anchor" aria-label="anchor" href="#arg-bss"></a></dt>
<dd><p>character vector; names of candidate spline bases (i.e., candidate shape types).</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>character; negative binomial ("nb", default) or Gaussian ("gaussian")</p></dd>


<dt id="arg-score">score<a class="anchor" aria-label="anchor" href="#arg-score"></a></dt>
<dd><p>character; model selection score, either Generalised Cross Validation ("gcv") or
Akaike Information Criterion ("aic")</p></dd>


<dt id="arg-cp-type">cp_type<a class="anchor" aria-label="anchor" href="#arg-cp-type"></a></dt>
<dd><p>character; if changepoints have been estimated using <code><a href="estimate_changepoint.html">estimate_changepoint()</a></code>,
which selection rule should be used. See <code><a href="estimate_changepoint.html">estimate_changepoint()</a></code> for details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a cpam object with the selected shapes added to the slot "shapes"</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function selects the best shape from a list of candidate shapes for each target.
It is typically the last step in the analysis, called after p-values have
been estimated using <code><a href="compute_p_values.html">compute_p_values()</a></code> and changepoints have
been estimated using <code><a href="estimate_changepoint.html">estimate_changepoint()</a></code>.</p>
<p>Two shape selections are generated. The first selecting among linear,
convex and concave shape classes and their monotonic variants (or the shape
set given by bss), and the second selecting among the first options plus an
'unconstrained' smooth. The inclusion of the 'unconstrained' type provides
the flexibility to detect targets beyond simpler trends.
For computational reasons, as per the changepoint estimation,
shapes are selected only for those genes, or their isoforms,
identified as significant at the chosen FDR threshold. This is
overridden by providing a subset of target names to the <code>subset</code> argument,
provided these targets have estimated changepoints.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://l-a-yates.github.io/cpam/">cpam</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load example data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"exp_design_example.rda"</span>, package <span class="op">=</span> <span class="st">"cpam"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"count_matrix_example.rda"</span>, package <span class="op">=</span> <span class="st">"cpam"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using a small subset of the example data</span></span></span>
<span class="r-in"><span><span class="va">cpo</span> <span class="op">&lt;-</span> <span class="fu"><a href="prepare_cpam.html">prepare_cpam</a></span><span class="op">(</span>exp_design <span class="op">=</span> <span class="va">exp_design_example</span>,</span></span>
<span class="r-in"><span>                    count_matrix <span class="op">=</span> <span class="va">count_matrix_example</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,<span class="op">]</span>,</span></span>
<span class="r-in"><span>                    gene_level <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                    num_cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Processing count matrix</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Processing count matrix <span style="color: #B2B2B2;">[18ms]</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Filtering low count genes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Estimating dispersions using <span style="color: #0000BB;">edgeR</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Estimating dispersions using <span style="color: #0000BB;">edgeR</span> <span style="color: #B2B2B2;">[44ms]</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Filtering low count genes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Filtering low count genes <span style="color: #B2B2B2;">[82ms]</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">cpo</span> <span class="op">&lt;-</span> <span class="fu"><a href="compute_p_values.html">compute_p_values</a></span><span class="op">(</span><span class="va">cpo</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cpo</span> <span class="op">&lt;-</span> <span class="fu"><a href="estimate_changepoint.html">estimate_changepoint</a></span><span class="op">(</span><span class="va">cpo</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimating changepoints for <span style="color: #0000BB;">3</span> targets</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Candidate changepoints are t = 1, 2, 3, 4, 5, and 6</span>
<span class="r-in"><span><span class="va">cpo</span> <span class="op">&lt;-</span> <span class="fu">select_shape</span><span class="op">(</span><span class="va">cpo</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimating shapes for <span style="color: #0000BB;">3</span> targets</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Candidate changepoints are bs = <span style="color: #0000BB;">"micv"</span>, <span style="color: #0000BB;">"mdcx"</span>, <span style="color: #0000BB;">"cv"</span>, <span style="color: #0000BB;">"cx"</span>, <span style="color: #0000BB;">"lin"</span>, <span style="color: #0000BB;">"tp"</span>, and</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">"null"</span></span>
<span class="r-in"><span><span class="va">cpo</span><span class="op">$</span><span class="va">shapes</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 3 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   target_id    cp shape1 shape2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> g003          1 mdcx   mdcx  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> g013          3 ilin   ilin  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> g014          5 null   null  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luke Yates, Michael Charleston, Jazmine Humphreys, Steven Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

